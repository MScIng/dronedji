(self.webpackChunkdji_aerial_georeferencing=self.webpackChunkdji_aerial_georeferencing||[]).push([[179],{29:(e,t,n)=>{var o=n(202);e.exports=(o.default||o).template({1:function(e,t,n,o,i){return'                <div class="bg-green-700 rounded-md shadow-lg text-center p-4 flex-1">\n                    <h3>Video Added</h3>\n                    <i class="fa-regular fa-square-check text-4xl mt-4 mb-2"></i>\n                </div>\n'},3:function(e,t,n,o,i){return'                <div id="videoButton" class="bg-purple-700 rounded-md shadow-lg text-center p-4 flex-1 hover:bg-purple-600 cursor-pointer">\n                    <h3>Add Drone Video</h3>\n                    <i class="fa-regular fa-video text-4xl mt-4 mb-2"></i>\n                </div>\n'},5:function(e,t,n,o,i){return'                <div class="bg-green-700 rounded-md shadow-lg text-center p-4 flex-1">\n                    <h3>Flight Log Added</h3>\n                    <i class="fa-regular fa-square-check text-4xl mt-4 mb-2"></i>\n                </div>\n'},7:function(e,t,n,o,i){return'                <div id="flightLogButton" class="bg-purple-700 rounded-md shadow-lg text-center p-4 flex-1 hover:bg-purple-600 cursor-pointer">\n                    <h3>Add Flight Log</h3>\n                    <i class="fa-regular fa-file-csv text-4xl mt-4 mb-2"></i>\n                </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,i){var a,r=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div id="dropContainer" class="w-full h-full bg-gray-900 text-purple-100 flex items-center justify-center">\n    <div class="py-4 px-8 bg-purple-900 rounded-md shadow-xl outline outline-1 outline-purple-400 outline-offset-4">\n        <h2 class="text-sm font-bold uppercase">Roboflow / DJI</h2>\n        <h1 class="text-2xl font-light">Drone Video Georeferencing Demo</h1>\n        <div class="flex space-x-4 mt-4 text-white">\n'+(null!=(a=l(n,"if").call(r,null!=t?l(t,"videoFile"):t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i,loc:{start:{line:6,column:12},end:{line:16,column:19}}}))?a:"")+(null!=(a=l(n,"if").call(r,null!=t?l(t,"flightLogFile"):t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i,loc:{start:{line:17,column:12},end:{line:27,column:19}}}))?a:"")+'        </div>\n    </div>\n</div>\n\n<div class="hidden">\n    <input id="videoInput" type="file" accept="video/*">\n    <input id="flightLogInput" type="file" accept="text/csv, application/csv">\n</div>'},useData:!0})},261:(e,t,n)=>{var o=n(202);e.exports=(o.default||o).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,o,i){return'<div id="map"></div>'},useData:!0})},227:()=>{},225:(e,t,n)=>{const o="rf_5w20VzQObTXjJhTjq6kad9ubrm33",i="aerial-solar-panels",a=5,r=.9,l=.5,d=n(755);window.$=d;const s=n(486);window._=s,d((function(){n(622)(),window.model=null,s.defer((function(){try{roboflow.auth({publishable_key:o}).load({model:i,version:a}).then((function(e){e.configure({threshold:r,overlap:l}),window.model=e}))}catch(e){console.error("error loading model",e&&e.error)}}))}))},567:(e,t,n)=>{const o="pk.eyJ1IjoieWVsZGFyYnkiLCJhIjoiY2w3czRlcG5qMGxvbDNxbnVoOTUzeW9nNCJ9.RKnzgCuuLaaFzcFsuZWdFQ",i=20,a=n(158);window.mapboxgl=a,n(652),a.accessToken=o;const r=n(460),l={point:n(102).point,rhumbDestination:n(54).Z,distance:n(13).Z};window.turf=l;const d=function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(e){var n=e.target.result,o=r.parse(n,{header:!0,transformHeader:function(e){return e.trim()}});t(o.data)},n.readAsText(e)}))};e.exports=async function(e,t){var o=n(261);$("body").html(o());const r=await d(t);var s=[],u=-1/0,c=1/0,p=1/0,f=-1/0;_.find(r,(function(e){if("0"==e.isVideo)return s.length;e.latitude=parseFloat(e.latitude),e.longitude=parseFloat(e.longitude),s.push(e),e.longitude>u&&(u=e.longitude),e.longitude<c&&(c=e.longitude),e.latitude<p&&(p=e.latitude),e.latitude>f&&(f=e.latitude)}));const g=new a.Map({container:"map",zoom:1,style:"mapbox://styles/mapbox/streets-v11"});window.map=g,g.on("load",(function(){var t={type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[_.map(s,(function(e){return[e.longitude,e.latitude]}))]}}};g.addSource("dronePath",t),g.addLayer({id:"droneOutline",type:"line",source:"dronePath",layout:{},paint:{"line-color":"#6706CE","line-width":3}}),g.addSource("video",{type:"video",urls:[URL.createObjectURL(e)],coordinates:[[(u+c)/2+7e-4,(p+f)/2-7e-4],[(u+c)/2+7e-4,(p+f)/2+7e-4],[(u+c)/2-7e-4,(p+f)/2+7e-4],[(u+c)/2-7e-4,(p+f)/2-7e-4]]}),g.addLayer({id:"video",type:"raster",source:"video"}),g.fitBounds([[u,p],[c,f]],{padding:50});var n=g.getSource("video"),o=Math.atan(60),r=!1,d=0,h=[],m=function(){requestAnimationFrame(m);var e=n.video;if(e&&e.videoWidth){e.playbackRate=4;var{videoWidth:t,videoHeight:u,currentTime:c}=e,p=Math.floor(10*c),f=s[p%s.length],v=l.point([f.longitude,f.latitude]),b=.3048*parseFloat(f["ascent(feet)"])*o,x=b/2,y=(parseFloat(f["compass_heading(degrees)"])-90)%360,w=57.2958*Math.atan(u/t),k={units:"meters"},C=l.rhumbDestination(v,x,(y-w+180)%360-180,k).geometry.coordinates,L=l.rhumbDestination(v,x,(y+w+180)%360-180,k).geometry.coordinates,D=l.rhumbDestination(v,x,(y-w)%360-180,k).geometry.coordinates,F=l.rhumbDestination(v,x,(y+w)%360-180,k).geometry.coordinates;n.setCoordinates([L,D,F,C]),window.model&&!r&&Date.now()-d>=200&&(r=!0,e.pause(),window.model.detect(e).then((function(e){_.each(e,(function(e){var n=[e.bbox.y-u/2,e.bbox.x-t/2],o=Math.sqrt((t/2-e.bbox.x)*(t/2-e.bbox.x)+(u/2-e.bbox.y)*(u/2-e.bbox.y))/Math.sqrt(t*t+u*u)*b,r=57.2958*Math.atan(n[0]/(n[1]||1e-6));n[1]>=0&&(r+=180);var d=l.rhumbDestination(v,o,(y+r)%360,k),s=_.find(h,(function(e,t){if(l.distance(d,e.location,{units:"kilometers"})<i/1e3){e.points.push(d.geometry.coordinates);var n=[0,0];if(_.each(e.points,(function(e){n[0]+=e[0],n[1]+=e[1]})),n[0]=n[0]/e.points.length,n[1]=n[1]/e.points.length,e.location=l.point(n),!e.marker&&e.points.length>=2){var o=(new a.Marker).setLngLat(n).addTo(g);e.marker=o}else e.marker&&e.marker.setLngLat(n);return!0}}));s||h.push({location:d,points:[d.geometry.coordinates],marker:null})}))})).finally((function(){r=!1,d=Date.now(),e.play()})))}};m()}))}},622:(e,t,n)=>{var o,i,a=function(){if(o&&i){n(567)(i,o)}else{var e=n(29);$("body").html(e({flightLogFile:o,videoFile:i})),$("#videoButton").click((function(){$("#videoInput").click()})),$("#flightLogButton").click((function(){$("#flightLogInput").click()}));var t=function(e){$("#dropContainer").removeClass("bg-gray-900").addClass("bg-green-900"),e.preventDefault(),e.stopPropagation()},r=function(e){$("#dropContainer").addClass("bg-gray-900").removeClass("bg-gray-700"),e.preventDefault(),e.stopPropagation(),_.each(e.originalEvent.dataTransfer.files,(function(e){e.type&&0==e.type.indexOf("video/")?i=e:e.type&&e.type.indexOf("/csv")>=0&&(o=e)})),a()};$("#dropContainer").bind({dragenter:t,dragover:t,dragleave:function(e){$("#dropContainer").addClass("bg-gray-900").removeClass("bg-green-900"),e.preventDefault(),e.stopPropagation()},drop:r,dragdrop:r}),$("#videoInput").change((function(e){i=e.currentTarget.files[0],a()})),$("#flightLogInput").change((function(e){o=e.currentTarget.files[0],a()}))}};e.exports=a}},e=>{var t=t=>e(e.s=t);e.O(0,[111],(()=>(t(225),t(227))));e.O()}]);
//# sourceMappingURL=main.7d24cc855716e495f5c7.js.map